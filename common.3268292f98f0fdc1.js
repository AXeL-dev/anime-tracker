"use strict";(self.webpackChunkanime_tracker=self.webpackChunkanime_tracker||[]).push([[592],{5360:(y,E,e)=>{e.d(E,{k:()=>g,E:()=>h});var g=(()=>{return(d=g||(g={})).Success="success",d.Info="info",d.Error="error",g;var d})(),h=(()=>{return(d=h||(h={})).Read="read",d.Unread="unread",h;var d})()},657:(y,E,e)=>{e.d(E,{_:()=>C});var g=e(6622),h=e(5427),d=e(4056),m=e(4128),f=e(7272),M=e(2805),n=e(4482),o=e(5403),t=e(4004),r=e(4351),l=e(3470),D=e(1223),w=e(7562),S=e(452),_=e(3631);let C=(()=>{class L{constructor(c,i,s){this.crawlers=c,this.settings=i,this.debug=s}search(c){const i=this.crawlers.getActive();return(0,m.D)(i.map(s=>s.searchAnime(c))).pipe((0,t.U)(s=>(0,g.x)(s)))}getLatestEpisodes(c=!1){const i=this.crawlers.getActive(c);return(0,m.D)(i.map(s=>s.getLatestEpisodes(c))).pipe((0,t.U)(s=>{const a=(0,g.x)(s.map(u=>u.slice(0,Math.min(u.length,this.settings.maxEpisodesToRetrieve))));return this.debug.log("All latest episodes:",a),this.debug.log("--------------------------"),this.mergeEpisodes(a)}))}getLatestEpisodesByDays(c=!1,i=50){const s=this.crawlers.getActive(c);let a=[],u=0;return i||(i=this.settings.maxEpisodesToRetrieve),(0,f.z)(...s.map(v=>v.getLatestEpisodes(c))).pipe((0,r.b)((v,A)=>{const R=v.slice(0,Math.min(v.length,this.settings.maxEpisodesToRetrieve));this.debug.log(`${s[A].name} latest episodes:`,R),this.debug.log("--------------------------"),a=this.mergeEpisodes(R,a);let U=!0;return(0,M.H)(100,500).pipe(function O(L,T=!1){return(0,n.e)((c,i)=>{let s=0;c.subscribe((0,o.x)(i,a=>{const u=L(a,s++);(u||T)&&i.next(a),!u&&i.complete()}))})}(()=>U),(0,t.U)(I=>{let P=I*i+u+i;P>=a.length&&(P=a.length,u=P,U=!1);const F=a.slice(0,P),B=this.settings.displayEpisodesDayByDay?this.getEpisodesDays(F):[];return this.debug.log("Slice",I,":",F),this.debug.log("Days:",B),this.debug.log("----------------------------"),[F,B]}))}))}mergeEpisodes(c,i=[]){return c.forEach(s=>{var a,u;let v=0;for(let A of i){if((0,d.T0)(A.anime.title,s.anime.title,this.settings.episodeSimilarityDegree)&&A.number===s.number)return(!i[v].releaseDate||i[v].hasTemporaryReleaseDate)&&(i[v].releaseDate=s.releaseDate,i[v].hasTemporaryReleaseDate=!1),(null===(a=s.streamLinks)||void 0===a?void 0:a.length)&&(i[v].streamLinks=[...i[v].streamLinks,...s.streamLinks]),(null===(u=s.downloadLinks)||void 0===u?void 0:u.length)&&(i[v].downloadLinks=[...i[v].downloadLinks,...s.downloadLinks]),s.anime.isNew&&!i[v].anime.isNew&&(i[v].anime.isNew=s.anime.isNew),void(s.anime.isFinished&&!i[v].anime.isFinished&&(i[v].anime.isFinished=s.anime.isFinished));v++}i.push(Object.assign(Object.assign({},s),{streamLinks:s.streamLinks||[],downloadLinks:s.downloadLinks||[]}))}),i.length&&(i=i.sort((s,a)=>this.settings.sortEpisodesBy===h.q.FetchingDate&&(0,l.zu)(s.releaseDate,a.releaseDate)?s.fetchingDate-a.fetchingDate:a.releaseDate-s.releaseDate)),i}getEpisodesDays(c){let i=[];return c.forEach(s=>{if(s.releaseDate){const a=(0,l.hp)(new Date(s.releaseDate));-1===i.indexOf(a)&&i.push(a)}}),i}}return L.\u0275fac=function(c){return new(c||L)(D.LFG(w.K),D.LFG(S.g),D.LFG(_.r))},L.\u0275prov=D.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),L})()},8604:(y,E,e)=>{e.d(E,{S:()=>m});var g=e(655),h=e(1223),d=e(1188);let m=(()=>{class f{constructor(n){this.storage=n,this.init()}init(){return(0,g.mG)(this,void 0,void 0,function*(){const n=yield this.storage.get("favorites");this.favorites=(null==n?void 0:n.length)?n:[]})}save(){this.storage.save("favorites",this.favorites)}get(){return this.favorites}add(n){this.isFavorite(n)||(this.favorites.push(n),this.save())}remove(n){const o=this.getIndexOf(n);-1!==o&&(this.favorites.splice(o,1),this.save())}isFavorite(n){return-1!==this.getIndexOf(n)}getIndexOf(n){var o;return null===(o=this.favorites)||void 0===o?void 0:o.indexOf(n)}refresh(){return this.init()}}return f.\u0275fac=function(n){return new(n||f)(h.LFG(d.V))},f.\u0275prov=h.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},9744:(y,E,e)=>{e.d(E,{T:()=>n});var g=e(655),h=e(5360),d=e(3470),m=e(1223),f=e(4071),M=e(5056);let n=(()=>{class o{constructor(t,r){this.browser=t,this.router=r,this.notifications=[],this.canSendMessage=!1,this.canUpdateBackgroundNotifications=!0,this.canSendMessage=this.browser.isWebExtension&&"/background"!==this.router.url,this.canSendMessage&&this.fetchFromBackgroundScript(),this.listenToConsole()}fetchFromBackgroundScript(){return(0,g.mG)(this,void 0,void 0,function*(){const t=yield this.browser.sendMessage("getNotifications");(null==t?void 0:t.length)&&(this.notifications=[...t])})}listenToConsole(){const t=console.error;console.error=(r,...l)=>{this.push(r,h.k.Error),t(r,...l)}}push(t,r=h.k.Info){this.notifications.unshift({message:t,type:r,date:(0,d.zO)(),status:h.E.Unread})}get(){return this.notifications}markAllAsRead(){return this.canSendMessage&&this.canUpdateBackgroundNotifications&&(this.browser.sendMessage("markNotificationsAsRead"),this.canUpdateBackgroundNotifications=!1),this.notifications.forEach(t=>{t.status=h.E.Read}),this.notifications}get unreadCount(){return this.notifications.filter(t=>!t.status||t.status===h.E.Unread).length}hasUnread(){return this.unreadCount>0}}return o.\u0275fac=function(t){return new(t||o)(m.LFG(f.q),m.LFG(M.F0))},o.\u0275prov=m.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},1942:(y,E,e)=>{e.d(E,{z:()=>n});var g=e(655),h=e(4056),d=e(1223),m=e(1188),f=e(452),M=e(4071);let n=(()=>{class o{constructor(t,r,l){this.storage=t,this.settings=r,this.browser=l,this.init()}init(){return(0,g.mG)(this,void 0,void 0,function*(){this.viewed=yield this.getAsync(!0),this.url=this.browser.getUrl("viewed")})}getAsync(t){var r;return(0,g.mG)(this,void 0,void 0,function*(){if((null===(r=this.viewed)||void 0===r?void 0:r.length)&&!t)return this.viewed;{const l=yield this.storage.get("viewed");return(null==l?void 0:l.length)?l:[]}})}save(){this.storage.save("viewed",this.viewed)}get(){return this.viewed}add(t){this.isViewed(t)||(this.viewed.push({animeTitle:t.anime.title,number:t.number}),this.save())}remove(t){var r,l;const D=null===(r=this.viewed)||void 0===r?void 0:r.filter(w=>!((0,h.T0)(w.animeTitle,t.anime.title,.9,!0)&&w.number===t.number));(null==D?void 0:D.length)<(null===(l=this.viewed)||void 0===l?void 0:l.length)&&(this.viewed=D,this.save())}isViewed(t){var r;return!!(null===(r=this.viewed)||void 0===r?void 0:r.find(l=>(0,h.T0)(l.animeTitle,t.anime.title,.9,!0)&&l.number===t.number))}isRegular(t){var r;return!!(null===(r=this.viewed)||void 0===r?void 0:r.find(l=>(0,h.T0)(l.animeTitle,t.anime.title,this.settings.episodeSimilarityDegree)))}refresh(){return this.init()}getEpisodeUrl(t){return`${this.url}/${t.anime.title}`}}return o.\u0275fac=function(t){return new(t||o)(d.LFG(m.V),d.LFG(f.g),d.LFG(M.q))},o.\u0275prov=d.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()}}]);