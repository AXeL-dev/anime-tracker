!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(u){a=!0,r=u}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return s}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return t(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(self.webpackChunkanime_tracker=self.webpackChunkanime_tracker||[]).push([[508],{2508:function(t,r,s){"use strict";s.r(r),s.d(r,{BackgroundModule:function(){return L}});var o,a,u=s(8583),c=s(5263),d=s(4762),f=s(5257),h=s(3470),l=s(4056),g=s(5360),p=s(2340),m=s(5491),b=s(639),v=s(4071),k=s(452),w=s(3631),y=s(961),C=s(8604),x=s(1942),A=s(9744),E=[{path:"**",component:(o=function(){function t(e,i,r,s,o,a,u,c){n(this,t),this.browser=e,this.settings=i,this.router=r,this.debug=s,this.animeProvider=o,this.favoriteAnimes=a,this.viewedEpisodes=u,this.notifications=c,this.checkedEpisodes=[],this.badgeCount=0}var r,s,o;return r=t,(s=[{key:"ngOnInit",value:function(){this.debug.enable(!0),this.browser.isWebExtension||!p.N.production?this.init():this.router.navigate(["/"])}},{key:"init",value:function(){var t,n,i=this;this.browser.setBadgeColors("#666","#fff"),this.debug.log({rate:this.settings.autoCheckRate,notifications:this.settings.enableNotifications?"on":"off"}),this.autoCheckLoop(),null===(t=this.browser.api)||void 0===t||t.notifications.onClicked.addListener(function(t){var n;i.debug.log("Notification clicked:",t);var r=e(t.split("::").map(function(e){return+e}),2),s=(r[0],r[1]);if(s>=0){var o=i.checkedEpisodes[s],a=null===(n=o.streamLinks[0])||void 0===n?void 0:n.url;(null==a?void 0:a.length)&&(i.browser.createTab(a),i.viewedEpisodes.add(o))}}),null===(n=this.browser.api)||void 0===n||n.runtime.onMessage.addListener(function(e,t,n){i.debug.log("Handle message:",e);var r=null;switch(e.message){case"getNotifications":r=i.notifications.get();break;case"markNotificationsAsRead":r=i.notifications.markAllAsRead();break;default:i.debug.warn('Cannot handle "'.concat(e.message,'" message!'))}i.debug.log("response:",r),n({response:r})})}},{key:"autoCheckLoop",value:function(){var t=this;setTimeout(function(){return(0,d.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r,s,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getRecentEpisodesCount();case 2:if(n=t.sent,i=e(n,2),r=i[0],s=i[1],this.debug.log("Recent episodes count:",r),t.t0=r>0,!t.t0){t.next=19;break}return t.next=11,this.browser.getBadgeText();case 11:if(!t.sent.length){t.next=15;break}this.badgeCount+=r,t.next=16;break;case 15:this.badgeCount=r;case 16:this.debug.log("Total count:",this.badgeCount),this.browser.setBadgeText(this.badgeCount),this.settings.enableNotifications&&s.forEach(function(e){o.notifications.push(e.message,g.k.Success);var t=(0,h.zO)().getTime()+"::"+e.episode.index;o.browser.sendNotification(e.message,t)});case 19:return t.next=21,this.settings.refresh();case 21:this.autoCheckLoop();case 22:case"end":return t.stop()}},t,this)}))},60*this.settings.autoCheckRate*1e3)}},{key:"getRecentEpisodesCount",value:function(){var e=this;return new Promise(function(t,n){return(0,d.mG)(e,void 0,void 0,regeneratorRuntime.mark(function e(){var n,i,r,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,i=[],e.next=3,this.animeProvider.getLatestEpisodes(!0).pipe((0,f.q)(1)).toPromise();case 3:return r=e.sent,this.debug.log("Latest episodes:",r),this.debug.log("Checked episodes:",this.checkedEpisodes),e.next=8,this.viewedEpisodes.refresh();case 8:return e.next=10,this.favoriteAnimes.refresh();case 10:r.forEach(function(e){!s.isAlreadyChecked(e)&&(0,h.GW)(new Date(e.releaseDate))&&!s.viewedEpisodes.isViewed(e)&&s.favoriteAnimes.isFavorite(e.anime.title)&&s.hasMatchingSubtitles(e)&&(i.push({message:"".concat(e.anime.title," ").concat(e.number," released!"),episode:{index:n}}),n++,s.checkedEpisodes.push(e))}),t([n,i]);case 12:case"end":return e.stop()}},e,this)}))})}},{key:"hasMatchingSubtitles",value:function(e){var t=this;return this.settings.preferredSubtitles===m.B.Any||!!e.streamLinks.find(function(e){return e.lang.toLowerCase()===t.settings.preferredSubtitles.toLowerCase()})}},{key:"isAlreadyChecked",value:function(e){var t=this;return!!this.checkedEpisodes.find(function(n){return(0,l.T0)(n.anime.title,e.anime.title,t.settings.episodeSimilarityDegree)&&n.number===e.number})}}])&&i(r.prototype,s),o&&i(r,o),t}(),o.\u0275fac=function(e){return new(e||o)(b.Y36(v.q),b.Y36(k.g),b.Y36(c.F0),b.Y36(w.r),b.Y36(y._),b.Y36(C.S),b.Y36(x.z),b.Y36(A.T))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-main"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),o)}],S=function(){var e=function e(){n(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=b.oAB({type:e}),e.\u0275inj=b.cJS({imports:[[c.Bz.forChild(E)],c.Bz]}),e}(),L=((a=function e(){n(this,e)}).\u0275fac=function(e){return new(e||a)},a.\u0275mod=b.oAB({type:a}),a.\u0275inj=b.cJS({imports:[[u.ez,S]]}),a)}}])}();