(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{GBrv:function(e,t,i){"use strict";i.r(t),i.d(t,"BackgroundModule",(function(){return k}));var s=i("ofXK"),o=i("tyNb"),n=i("mrSG"),r=i("IzEk"),a=i("73Pe"),d=i("Qw5O"),h=i("AytR"),c=i("E8n8"),u=i("fXoL"),b=i("tQGB"),l=i("6nr9"),p=i("cqYI"),g=i("RKI1"),f=i("vKPz"),m=i("XPoy");const w=[{path:"**",component:(()=>{class e{constructor(e,t,i,s,o,n,r){this.browser=e,this.settings=t,this.router=i,this.debug=s,this.animeProvider=o,this.favoriteAnimes=n,this.viewedEpisodes=r,this.checkedEpisodes=[],this.badgeCount=0}ngOnInit(){this.debug.enable(!0),this.browser.isWebExtension||!h.a.production?this.init():this.router.navigate(["/"])}init(){var e;this.browser.setBadgeColors("#666","#fff"),this.debug.log({rate:this.settings.autoCheckRate,notifications:this.settings.enableNotifications?"on":"off"}),this.autoCheckLoop(),null===(e=this.browser.api)||void 0===e||e.notifications.onClicked.addListener(e=>{var t;this.debug.log("Notification clicked:",e);const[i,s]=e.split("::").map(e=>+e);if(s>=0){const e=this.checkedEpisodes[s],i=null===(t=e.streamLinks[0])||void 0===t?void 0:t.url;(null==i?void 0:i.length)&&(this.browser.createTab(i),this.viewedEpisodes.add(e))}})}autoCheckLoop(){setTimeout(()=>Object(n.a)(this,void 0,void 0,(function*(){const[e,t]=yield this.getRecentEpisodesCount();this.debug.log("Recent episodes count:",e),e>0&&((yield this.browser.getBadgeText()).length?this.badgeCount+=e:this.badgeCount=e,this.debug.log("Total count:",this.badgeCount),this.browser.setBadgeText(this.badgeCount),this.settings.enableNotifications&&t.forEach(e=>{const t=Object(a.f)().getTime()+"::"+e.episode.index;this.browser.sendNotification(e.message,t)})),yield this.settings.refresh(),this.autoCheckLoop()})),60*this.settings.autoCheckRate*1e3)}getRecentEpisodesCount(){return new Promise((e,t)=>Object(n.a)(this,void 0,void 0,(function*(){let t=0,i=[];const s=yield this.animeProvider.getLatestEpisodes(!0).pipe(Object(r.a)(1)).toPromise();this.debug.log("Latest episodes:",s),this.debug.log("Checked episodes:",this.checkedEpisodes),yield this.viewedEpisodes.refresh(),yield this.favoriteAnimes.refresh(),s.forEach(e=>{!this.isAlreadyChecked(e)&&Object(a.e)(new Date(e.releaseDate))&&!this.viewedEpisodes.isViewed(e)&&this.favoriteAnimes.isFavorite(e.anime.title)&&this.hasMatchingSubtitles(e)&&(i.push({message:`${e.anime.title} ${e.number} released!`,episode:{index:t}}),t++,this.checkedEpisodes.push(e))}),e([t,i])})))}hasMatchingSubtitles(e){return this.settings.preferredSubtitles===c.a.Any||!!e.streamLinks.find(e=>e.lang.toLowerCase()===this.settings.preferredSubtitles.toLowerCase())}isAlreadyChecked(e){return!!this.checkedEpisodes.find(t=>Object(d.a)(t.anime.title,e.anime.title)&&t.number===e.number)}}return e.\u0275fac=function(t){return new(t||e)(u.Xb(b.a),u.Xb(l.a),u.Xb(o.c),u.Xb(p.a),u.Xb(g.a),u.Xb(f.a),u.Xb(m.a))},e.\u0275cmp=u.Rb({type:e,selectors:[["app-main"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),e})()}];let v=(()=>{class e{}return e.\u0275mod=u.Vb({type:e}),e.\u0275inj=u.Ub({factory:function(t){return new(t||e)},imports:[[o.f.forChild(w)],o.f]}),e})(),k=(()=>{class e{}return e.\u0275mod=u.Vb({type:e}),e.\u0275inj=u.Ub({factory:function(t){return new(t||e)},imports:[[s.b,v]]}),e})()}}]);